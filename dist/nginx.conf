# nginx.conf
worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    gzip on;
    gzip_types text/plain text/css application/json application/javascript;

    # Define a strong Content Security Policy to be used by the servers.
    # This helps prevent XSS, data injection, and clickjacking attacks.
    # - default-src 'self': By default, only allow resources from our own domain.
    # - script-src 'self': Only allow JavaScript from our own domain.
    # - style-src 'self' 'unsafe-inline': Allow CSS from our own domain and inline styles (needed for many UI libraries like Chakra UI).
    # - connect-src 'self' http://localhost:8080: Allows the frontend to make API calls to the backend.
    # - frame-ancestors 'none': Disallows any other site from embedding this page in an iframe (prevents ClickJacking).
    # - form-action 'self': Restricts where HTML forms on the page can submit their data.
    add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self' http://localhost:8080; frame-ancestors 'none'; form-action 'self';" always;

    # An older header to prevent ClickJacking. CSP's frame-ancestors is more modern,
    # but including this provides deeper browser compatibility.
    add_header X-Frame-Options "DENY" always;

    # Prevents the browser from trying to guess the content type of a response.
    add_header X-Content-Type-Options "nosniff" always;


    # Server for User Dashboard on port 3000
    server {
        listen 3000;
        server_name localhost;

        root /usr/share/nginx/html/user-dashboard;
        index index.html index.htm;

        location / {
            try_files $uri $uri/ /index.html;
        }
    }

    # Server for Sample Client on port 3200
    server {
        listen 3200;
        server_name localhost;

        root /usr/share/nginx/html/sample-client;
        index index.html index.htm;

        location / {
            try_files $uri $uri/ /index.html;
        }
    }
}
